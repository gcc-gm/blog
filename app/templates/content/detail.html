{% extends 'base.html' %}

{% block title %}
    detail
{% endblock %}
{% block scripts %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {{ pagedown.include_pagedown() }}
    <link href="{{ url_for('static',filename='css/info.css') }}" rel="stylesheet">
{% endblock %}

{% block fenlei %}
    <div class="fenlei">
        <h2>文章分类</h2>
        <ul>
            {% for sort in sorts %}
                <li onclick="sorted({{ sort.id }})"><a href="#">{{ sort.name }}（{{ sort.total }}）</a></li>
            {% endfor %}

        </ul>
    </div>

{% endblock %}

{% block cloud %}
    <div class="cloud">
        <h2>标签云</h2>
        <ul>
            {% for t in tags_cloud %}
                <a href="/">{{ t.name }}</a>
            {% endfor %}
        </ul>
    </div>
{% endblock %}
{% block guanzhu %}
    <div class="guanzhu">
        <h2>关注我 么么哒</h2>
        <ul>
            <img src="{{ url_for('static',filename='images/1.jpg') }}">
        </ul>
    </div>
{% endblock %}
{% block main %}
    <main>
        <div class="infosbox">
            <div class="newsview">
                <h3 class="news_title">{{ article.name }}</h3>
                <div class="bloginfo">
                    <ul>
                        <li class="author">作者：<a href="/">{{ article.author }}</a></li>
                        <li class="lmname"><a href="/">学无止境</a></li>
                        <li class="timer">{{ article.timestamp }}</li>
                        <li class="view">点赞： {{ article.like_info }}</li>
                    </ul>
                </div>
                <div class="tags">
                    {% for tag in tags %}
                        <a href="/" target="_blank">{{ tag.name }}</a>
                        &nbsp;
                    {% endfor %}
                </div>
                <div class="news_about">
                    <strong>简介</strong>
                    <p>{{ article.intro }}</p>
                </div>
                <div class="news_con">
                    {{ article.body|safe }}
                </div>
            </div>
            <div class="share">
                <p class="diggit">
                    {% if current_user.is_authenticated %}
                        <a href="{{ url_for('blog.like_article',aid=article.id ) }}">
                            <b>点个赞呗!</b>&nbsp;(<b>{{ article.like_info }}</b>)
                        </a>
                    {% else %}
                        <a href="{{ url_for('blog.login' ) }}">
                            <b>登陆后点赞!</b>
                        </a>
                    {% endif %}
                </p>
            </div>
            <div class="nextinfo">
                <p>上一篇：<a href="/">{{ article.pre_name }}</a></p>
                <p>下一篇：<a href="/">{{ article.next_name }}</a></p>
            </div>
            <div class="news_pl">
                <h2>文章评论</h2>
                <div class="gbko">
                    {% for comment in comments %}

                        <div class="fb">
                            <ul style="background: url({{ url_for('static',filename='images/tx7.jpg') }}) no-repeat top 20px left 10px;">
                                <p class="fbtime"><span>{{ comment.timestamp }}</span> {{ comment.f_name }}</p>
                                <cpntent class="fbinfo">{{ comment.body_html|safe }}</cpntent>
                                {% if comment.to_id %}
                                    <div class="ecomment"><span class="ecommentauthor">网友 {{ comment.t_name }} 的原文：</span>
                                        <p class="ecommenttext">{{ comment.t_content|safe }}</p>
                                    </div>
                                {% endif %}

                            </ul>
                        </div>
                    {% endfor %}
                    <script>
                        let csrftoken = $('meta[name=csrf-token]').attr('content');

                        $.ajaxSetup({
                            beforeSend: function (xhr, settings) {
                                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                                    xhr.setRequestHeader("X-CSRFToken", csrftoken)
                                }
                            }
                        });

                        function CheckPl(obj) {
                            if (obj.body.value.length == 1) {
                                console.log(12);
                                obj.body.focus();
                                return false;
                            }
                            return true;
                        }
                    </script>
                    <form action="/" method="post" name="saypl" id="saypl"
                          onsubmit="return CheckPl(document.saypl)">
                        <div id="plpost">
                            <p class="saying"><span><a href="#">共有
                                    <script type="text/javascript"
                                            src="#"></script>
                                    {{ counts }}条评论</a></span>来说两句吧...
                            </p>
                            <div class="yname"><span>邮箱:</span>
                                <label for="">
                                    <input name="email" type="text" class="inputText" id="email" value="" size="16"
                                           required/>
                                </label>
                            </div>
                            <div class="yzm"><span>密码:</span>
                                <label>
                                    <input name="password" type="password" class="inputText" size="16" required/>
                                </label>
                            </div>

                            {{ form.csrf_token() }}
                            {{ form.body(style='with=100%' ,class="text-body", rows="5", placeholder="你有什么想法？") }}
                            {{ form.submit() }}

                        </div>
                    </form>
                </div>
            </div>
        </div>
{% endblock %}